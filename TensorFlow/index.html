<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="TensorFlow.js" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>WebGPU</title>
</head>

<body>
    <script>
        loadDoc();
        function loadDoc() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    myFunction(this);
                }
            };
            xhttp.open("GET", "/Chapter1/", true);
            xhttp.send();
        }

        function myFunction(xml) {
            // console.log(xml.responseText)
            var parser = new DOMParser();
            var htmlDoc = parser.parseFromString(xml.responseText, 'text/html');
            var preList = htmlDoc.getElementsByTagName("pre")[0].getElementsByTagName("a")
            for (i = 1; i < preList.length; i++) {
                console.log(preList[i].innerHTML)
            }
        }

        //(async () => {
        //    const response = await fetch('https://hoomanator.github.io/WebGPU/Chapter1/');
        //  const data = await response.json();
        //  let htmlString = '<ul>';

        //  for (let file of data) {
        //    htmlString += `<li><a href="${file.path}">${file.name}</a></li>`;
        //  }

        //  htmlString += '</ul>';
        //  document.getElementsByTagName('body')[0].innerHTML = htmlString;
        //})()
    </script>
</body>

</html>



<!-- HEADER -->
<div id="header_wrap" class="outer">
    <header class="inner">
        <h1 id="project_title">TensorFlow.js Tutorial</h1>
    </header>
</div>

<!-- MAIN CONTENT -->
<div id="main_content_wrap" class="outer">
    <section id="main_content" class="inner">
        <h3>Welcome to TensorFlow.js</h3>
        Explore pre-trained models to add computer vision, natural language processing (NLP), and other common ML tasks
        to your web and browser-based applications.

        <p>
            A tensor is a data structure that could hold scalars, vectors (one dimensional numbers), Matrix (2
            dimensional
            numbers), ..., and n-dimensional numbers.
            Tensorflow is a Google open source C++ library started in 2015 under Apache license. There is a Python and
            Java bindings for the Tensorflow project. Nikhil Thorat and Daniel Smilkov are the creators of the
            deeplearn.js
            project.

            The deeplearn.js project brought tensorflow to javascript. Deeplearn.js became Tensorflow.js.

            Keras was a high level API on top of Tensorflow, Theano, and Pytorch. Keras now is part of "layers" api of
            tensorflow.js. The core api of tensorflow.js includes all the basic tensorflow operations.

            ML5 is also a high level javascript API on top of tensorflow.js.

            To start your first project:

        <p></p>

        1. Create an html file: index.html
        <pre>
                <xmp>
                <!DOCTYPE html>
                <html lang="en">

                <head>
                    <title>TensorFlow.js</title>
                    <meta charset="utf-8">
                    <meta http-equiv="X-UA-Compatible" content="IE=edge">
                    <meta name="viewport" content="width=device-width, initial-scale=1">
                    <link rel="shortcut icon" href="H.ico">
                    <!-- Import the webpage's stylesheet -->
                    <link rel="stylesheet" href="style.css">
                </head>

                <body>
                    <h1>Tensors Creation</h1>

                    <!-- Import p5 library -->
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.4/p5.min.js"></script>

                    <!-- Import TensorFlow.js library -->
                    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0/dist/tf.min.js"
                        type="text/javascript"></script>

                    <!-- Import the page's JavaScript to do some stuff -->
                    <script src="sketch.js"></script>
                </body>

                </html>
              </xmp>
        </pre>
        2. Create a Javascript file: sketch.js
        <pre>
            <xmp>
                function setup(){
                noCanvas();

                //Example: Scalar tensor representing 0-dimensional array
                const data = tf.tensor(4);
                //const data = tf.scalar(4);  -- same
                data.print()
                
                //Example 1: Vector tensor representing a 1-dimensional array
                const data1 = tf.tensor([1, 2, 3, 4]);
                data1.print(); //    [1, 2, 3, 4]
                console.log(data1);
                console.log(data1.toString()); //same as data.print()
                
                //Example 2: A 2x2 tensor representing a 2-dimensional array
                const data2 = tf.tensor([255,0,0,255], [2,2]);  
                data2.print(); // [[255, 0  ],[0  , 255]]

                //Example 3: A 2x2x2 tensor representing a 3-dimensional array
                const data3 = tf.tensor([255,0,32 ,255, 127, 0, 127, 127], [2,2,2]);  
                data3.print(); //  [[[255, 0  ],[32 , 255]], [[127, 0  ],[127, 127]]]

                //Example 4: A 2x2x2X2 tensor representing a 4-dimensional integer array
                const data4 = tf.tensor([255.1,0,32.3 ,255, 127, 0, 127, 12, 255,0,32 ,255, 127, 0, 127, 1277], [2,2,2, 2], 'int32');  
                data4.print(); // [[[[255, 0],[32,255]],[[127, 0],[127, 12]]],[[[255, 0 ],[32 , 255 ]],[[127, 0 ],[127, 1277]]]]

                //Example 5: A 5x3 tensor representing a 2-dimensional array
                const  values5 = [];
                for(let i=0; i<15; i++){
                values5[i] = random(0,100);  
                }

                const shape = [5,3];
                const data5 = tf.tensor(values5, shape);
                data5.print();
                //[[15.3574314, 77.6350708, 28.1846237],
                //    [67.9104309, 53.8909607, 91.4151306],
                //    [96.7664871, 74.5445099, 35.9917641],
                //    [2.9171336 , 89.9953918, 85.0509186],
                //    [25.8264122, 64.3119736, 3.939127  ]]

                }
            </xmp>
         </pre>

        Congrats! You created your first tensor stored in the GPU of your computer.
        </p>
        <p>
            Tensor is an asynchronous operation. Let's try couple of tensor functiond like the data() function of a
            tensor:
        </p>


        <p>
        <pre>
            <xmp>
            function setup() {
                noCanvas();


                const values = [];
                for (let i = 0; i < 15; i++) {
                    values[i] = random(0, 100);
                }

                const shape = [5, 3];
                const data1 = tf.tensor(values, shape);
                data1.print();

                // data() function of a tensor returns a "promise"
                console.log(data1.data());

                // once the promise is resolved, then...
                data1.data().then(function (stuff) {
                    console.log(stuff);
                }
                );

                //Or alternatively, you can use dataSync()
                console.log(data1.dataSync());

                // Once you create a tensor, it's immutable. If you need to modify a tensor, 
                // you need to use variable function() to make a copy of a tensor, and then assign function()
                const vdata = tf.variable(data1);
                vdata.assign(tf.tensor([[4, 5, 6], [4, 5, 6], [4, 5, 6], [4, 5, 6], [4, 5, 6]]));
                console.log(vdata);

                // Addition operation
                const a = tf.tensor1d([1, 2, 3, 4]);
                const b = tf.tensor1d([10, 20, 30, 40]);

                a.add(b).print();  // or tf.add(a, b)

                // Matrix multiplication
                const a1 = tf.tensor2d([1, 2], [1, 2]);
                const b1 = tf.tensor2d([1, 2, 3, 4], [2, 2]);

                a1.matMul(b1).print();  // or tf.matMul(a1, b1)

                }
            </xmp>
        </pre>
        </p>

        <p>
            Memory Managment 
        </p>
        <p>
            To simualte the memory leak, we are moving our tensor creation to p5 draw() function for every frame. Then
            we will use dispose or tidy functions to dispose those tensors.
        </p>
        <p>
        <pre>
            <xmp>                
                function setup() {
                    noCanvas();
                    //every one second, call the draw function
                    frameRate(1);
                    }

                    function draw() {
                    const values = [];
                    for (let i = 0; i < 15; i++) {
                        values[i] = random(0, 100);
                    }

                    const shape = [5, 3];
                    const data1 = tf.tensor(values, shape);
                    //data1.print();
                    
                    //How many tensors are held in the memory
                    console.log(tf.memory().numTensors);

                    data1.dispose();

                    //or you can use tf.tidy

                    tf.tidy(myStuff);

                    function myStuff()
                    {
                        const data1 = tf.tensor(values, shape);
                        //console.log('hello');
                    }

                    //or use lambda fat arrow
                    tf.tidy(() => {
                        const data1 = tf.tensor(values, shape);
                    }
                    );
                }
            </xmp>
        </pre>
        </p>

        <p>
            Linear Regression 
        </p>
        <p>
            In this section, we use the TensorFlow.js library to create an interactive demonstration of linear regression (with stochastic gradient descent!)
        </p>
        <p>
        <pre>
            <xmp> 
            let x_vals = [];
            let y_vals = [];

            // y = mx + b m(slope) b(starting height on y-axis)
            let m, b;

            const learningRate = 0.2;
            const optimizer = tf.train.sgd(learningRate);

            function setup() {
            createCanvas(400, 400);
            m = tf.variable(tf.scalar(random(1)));
            b = tf.variable(tf.scalar(random(1)));
            }

            function predict(x) {
            const xs = tf.tensor1d(x);
            // y = mx + b
            const ys = xs.mul(m).add(b);
            return ys;
            }

            //prediction is the guess and labels are the actual y(by pressing the mouse button)
            function loss(pred, labels) {
            return pred.sub(labels).square().mean();
            }

            function mousePressed() {
            let x = map(mouseX, 0, width, 0, 1);
            let y = map(mouseY, 0, height, 1, 0)
            x_vals.push(x);
            y_vals.push(y);
            }

            function draw() {

            tf.tidy(() => {
                if (x_vals.length > 0) {
                const ys = tf.tensor1d(y_vals);
                optimizer.minimize(() => loss(predict(x_vals), ys));
                }
            }
            );

            background(0);
            stroke(255);
            strokeWeight(8);
            for (let i = 0; i < x_vals.length; i++) {
                let px = map(x_vals[i], 0, 1, 0, width);
                let py = map(y_vals[i], 0, 1, height, 0);
                point(px, py);
            }

            const lineX = [0, 1];
            const ys = tf.tidy(() => predict(lineX));
            let lineY = ys.dataSync();
            ys.dispose();

            let x1 = map(lineX[0], 0, 1, 0, width);
            let x2 = map(lineX[1], 0, 1, 0, width);

            let y1 = map(lineY[0], 0, 1, height, 0);
            let y2 = map(lineY[1], 0, 1, height, 0);

            strokeWeight(2);
            line(x1, y1, x2, y2);

            console.log(tf.memory().numTensors);
            //noLoop();
            }
            </xmp>
        </pre>
        </p>

    Use the following links to try TensorFlow yourself (Press F12 on chrome to see the console):
    <p> <a href="https://hoomanator.github.io/TensorFlow/src/tf003/index.html" class="tensorflow">Tensor
            Creation</a> </p>
    <p> <a href="https://hoomanator.github.io/TensorFlow/src/tf004/index.html" class="tensorflow">Tensor
            Opreations</a> </p>
    <p> <a href="https://hoomanator.github.io/TensorFlow/src/tf005/index.html" class="tensorflow">Memory Management</a>
    </p>
    <p> <a href="https://hoomanator.github.io/TensorFlow/src/tf006/index.html" class="tensorflow">Linear Regression</a>
    </p>


    </section>
</div>

<!-- FOOTER  -->
<div id="footer_wrap" class="outer">
    <footer class="inner">
        <p> <a href="https://hoomanator.azurewebsites.net/">Hoomanator Home Page</a></p>
    </footer>
</div>